import{createClient as e,createRequest as t}from"@urql/core";export*from"@urql/core";import{createContext as r,useContext as n,useRef as u,useState as o,useCallback as i,useEffect as c,useMemo as a}from"react";import{toPromise as s,subscribe as f,takeWhile as l,onEnd as p}from"wonka";import{useSyncExternalStore as v}from"use-sync-external-store/shim";var d=r(e({url:"/graphql"})),y=d.Provider,x=d.Consumer;function h(){return n(d)}function g(){return(g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}d.displayName="UrqlContext";var b={fetching:!1,stale:!1,error:void 0,data:void 0,extensions:void 0,operation:void 0};function q(e,t){var r=g({},e,t,{data:void 0!==t.data||t.error?t.data:e.data,fetching:!!t.fetching,stale:!!t.stale});return function(e,t){if("object"!=typeof e||"object"!=typeof t)return e!==t;for(var r in e)if(!(r in t))return!0;for(var n in t)if(e[n]!==t[n])return!0;return!1}(e,r)?r:e}function m(e,t){for(var r=0,n=t.length;r<n;r++)if(e[r]!==t[r])return!0;return!1}function k(e){var r=u(!0),n=h(),a=o(b),f=a[0],l=a[1],p=i((function(u,o){return l(g({},b,{fetching:!0})),s(n.executeMutation(t(e,u),o||{})).then((function(e){return r.current&&l({fetching:!1,stale:!!e.stale,data:e.data,error:e.error,extensions:e.extensions,operation:e.operation}),e}))}),[n,e,l]);return c((function(){return r.current=!0,function(){r.current=!1}}),[]),[f,p]}function P(e,r){var n=u(void 0);return a((function(){var u=t(e,r);return void 0!==n.current&&n.current.key===u.key?n.current:(n.current=u,u)}),[e,r])}var w=b,V=g({},b,{fetching:!0});function j(e,t){return e.suspense&&(!t||!1!==t.suspense)}function Q(e){var t=h(),r=P(e.query,e.variables),n=function(e){if(!e._react){var t=new Set,r=new Map;e.operations$&&f((function(e){"teardown"===e.kind&&t.has(e.key)&&(t.delete(e.key),r.delete(e.key))}))(e.operations$),e._react={get:function(e){return r.get(e)},set:function(e,n){t.delete(e),r.set(e,n)},dispose:function(e){t.add(e)}}}return e._react}(t),u=[t,r,e.pause,e.requestPolicy,e.context],c=o((function(){return{source:e.pause?null:t.executeQuery(r,g({},{requestPolicy:e.requestPolicy},e.context)),prevValue:w,deps:u,suspense:j(t,e.context)}})),s=c[0],p=c[1],d=s.source,y=s.deps,x=s.suspense,b=a((function(){var e=n.get(r.key);return[function(){if(!d)return w;if(e){if(x&&null!=e&&"then"in e)throw e}else{var t,u=f((function(u){e=u,x&&n.set(r.key,e),t&&(t(e),t=void 0)}))(l((function(){return x&&(!t||e&&e.then)||!e}))(d));if(null==e&&x){var o=e=new Promise((function(e){t=e}));throw n.set(r.key,o),o}u.unsubscribe()}return e||V},function(t){if(!d)return function(){};var u=f((function(u){e=u,x&&n.set(r.key,e),t()}))(d).unsubscribe;return function(){n.dispose(r.key),u()}}]}),[d,e.pause]),k=b[0],Q=b[1],S=i((function(n){var u=g({},{requestPolicy:e.requestPolicy},e.context,n);p((function(e){return{prevValue:e.prevValue,deps:e.deps,source:t.executeQuery(r,u),suspense:j(t,u)}}))}),[t,r,e.requestPolicy,e.context]),M=s.prevValue=q(s.prevValue,v(Q,k,k));return m(y,u)&&!e.pause&&p({prevValue:M,source:e.pause?null:t.executeQuery(r,g({},{requestPolicy:e.requestPolicy},e.context)),deps:u,suspense:j(t,e.context)}),[M,S]}function S(e,t){var r=h(),n=P(e.query,e.variables),s=u(t);s.current=t;var l=a((function(){return e.pause?null:r.executeSubscription(n,e.context)}),[r,n,e.pause,e.context]),v=[r,n,e.context,e.pause],d=o((function(){return[l,g({},b,{fetching:!!l}),v]})),y=d[0],x=d[1],k=y[1];return l!==y[0]&&m(y[2],v)&&x([l,k=q(y[1],{fetching:!!l}),v]),c((function(){function e(e){x((function(t){var r=q(t[1],e);return t[1]===r?t:(s.current&&t[1].data!==r.data&&(r.data=s.current(t[1].data,r.data)),[t[0],r,t[2]])}))}if(y[0])return f(e)(p((function(){e({fetching:!1})}))(y[0])).unsubscribe;e({fetching:!1})}),[y[0]]),[k,i((function(t){var u=r.executeSubscription(n,g({},e.context,t));x((function(e){return[u,e[1],e[2]]}))}),[r,e.context,n])]}function M(e){var t=k(e.query);return e.children(g({},t[0],{executeMutation:t[1]}))}function O(e){var t=Q(e);return e.children(g({},t[0],{executeQuery:t[1]}))}function _(e){var t=S(e,e.handler);return e.children(g({},t[0],{executeSubscription:t[1]}))}export{x as Consumer,d as Context,M as Mutation,y as Provider,O as Query,_ as Subscription,h as useClient,k as useMutation,Q as useQuery,S as useSubscription};
//# sourceMappingURL=urql.min.es.js.map
